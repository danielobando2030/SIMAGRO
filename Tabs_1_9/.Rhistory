return(format(round(x), big.mark = ".", small.mark = ","))
}
}
BD$tooltip_text <- paste0(
"<b>Año:</b> ", BD$var1,
"<br><b>Valor:</b> ", f1(BD$value, formato),
"<br><b>Mediana:</b> ", f1(BD$mediana, formato),
"<br><b>Q1:</b> ", f1(BD$q1, formato),
"<br><b>Q3:</b> ", f1(BD$q3, formato),
"<br><b>Promedio:</b> ", f1(BD$promedio, formato)
)
graf <- ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
geom_text(
aes(y = mediana, label = f1(mediana, formato)),
vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
) +
geom_text(
aes(y = q1, label = f1(q1, formato)),
vjust = -0.6, size = 2.5, color = "black"
) +
geom_text(
aes(y = q3, label = f1(q3, formato)),
vjust = -0.6, size = 2.5, color = "black"
) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
),
guide = "none"
) +
labs(
x = "Año",
y = "Kilogramos",
title = paste0("Distribución de abastecimiento por año\n(",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO), ")")
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 90, hjust = 1),
plot.title = element_text(face = "bold", hjust = 0.5)
)
# --- 7. Versión interactiva con plotly ---
graf_plotly <- plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)),
title = list(text = paste0("<b>Distribución de abastecimiento por año</b><br>",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO)))
)
if (!is.null(ALIMENTO)) {
BD <- subset(abastecimiento_bogota_ANO_mes_alimento_completo, producto == ALIMENTO)
} else {
BD <- abastecimiento_bogota_ANO_mes_total_completo
}
# --- 2. Limpieza y transformación ---
BD$mes <- months(as.Date(paste0("2025-", BD$mes, "-01")))
BD$suma_kg <- as.numeric(BD$suma_kg)
BD$anio <- as.factor(BD$anio)
BD <- BD[, c("anio", "suma_kg")]
names(BD) <- c("var1", "value")
BD <- BD[rowSums(is.na(BD)) == 0, ]
BD
resumen <- BD %>%
group_by(var1) %>%
summarise(
mediana = median(value, na.rm = TRUE),
q1 = quantile(value, 0.25, na.rm = TRUE),
q3 = quantile(value, 0.75, na.rm = TRUE),
promedio = mean(value, na.rm = TRUE)
)
BD
resumen
BD <- left_join(BD, resumen, by = "var1")
BD
f1 <- function(x, formato) {
if (formato == "percent") {
return(scales::percent(x, accuracy = 0.1, big.mark = ".", decimal.mark = ","))
} else if (formato == "dollar") {
return(scales::dollar(x, big.mark = ".", decimal.mark = ","))
} else {
return(format(round(x), big.mark = ".", small.mark = ","))
}
}
# --- 5. Tooltip interactivo ---
BD$tooltip_text <- paste0(
"<b>Año:</b> ", BD$var1,
"<br><b>Valor:</b> ", f1(BD$value, formato),
"<br><b>Mediana:</b> ", f1(BD$mediana, formato),
"<br><b>Q1:</b> ", f1(BD$q1, formato),
"<br><b>Q3:</b> ", f1(BD$q3, formato),
"<br><b>Promedio:</b> ", f1(BD$promedio, formato)
)
BD
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15)
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
geom_text(
aes(y = mediana, label = f1(mediana, formato)),
vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
)
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
#geom_text(
#  aes(y = mediana, label = f1(mediana, formato)),
#  vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
#) +
#geom_text(
#  aes(y = q1, label = f1(q1, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
#geom_text(
#  aes(y = q3, label = f1(q3, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
),
guide = "none"
)
labs(
x = "Año",
y = "Kilogramos",
title = paste0("Distribución de abastecimiento por año\n(",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO), ")")
)
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
#geom_text(
#  aes(y = mediana, label = f1(mediana, formato)),
#  vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
#) +
#geom_text(
#  aes(y = q1, label = f1(q1, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
#geom_text(
#  aes(y = q3, label = f1(q3, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
),
guide = "none"
) +
labs(
x = "Año",
y = "Kilogramos",
title = paste0("Distribución de abastecimiento por año\n(",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO), ")")
)
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
#geom_text(
#  aes(y = mediana, label = f1(mediana, formato)),
#  vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
#) +
#geom_text(
#  aes(y = q1, label = f1(q1, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
#geom_text(
#  aes(y = q3, label = f1(q3, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
),
guide = "none"
) +
labs(
x = "Año",
y = "Kilogramos",
title = paste0("Distribución de abastecimiento por año\n(",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO), ")")
) +
theme_minimal(base_size = 13)
ggplot(BD, aes(x = var1, y = value, fill = var1, text = tooltip_text)) +
geom_violin(color = "black", alpha = 0.8, width = 1) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA) +
geom_jitter(size = 1, color = "gray40", alpha = 0.4, width = 0.15) +
#geom_text(
#  aes(y = mediana, label = f1(mediana, formato)),
#  vjust = -0.6, size = 2.8, color = "black", fontface = "bold"
#) +
#geom_text(
#  aes(y = q1, label = f1(q1, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
#geom_text(
#  aes(y = q3, label = f1(q3, formato)),
#  vjust = -0.6, size = 2.5, color = "black"
#) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
),
guide = "none"
) +
labs(
x = "Año",
y = "Kilogramos") +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 90, hjust = 1)
)
plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)),
title = list(text = paste0("<b>Distribución de abastecimiento por año</b><br>",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO)))
)
BD$var1
BD$value
graf <- ggplot(BD, aes(x = var1, y = value, fill = var1)) +
geom_violin(color = "black", alpha = 0.8, width = 1, show.legend = FALSE) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA, show.legend = FALSE) +
geom_jitter(aes(text = tooltip_text), size = 1, color = "gray40", alpha = 0.4, width = 0.15, show.legend = FALSE) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
)
) +
labs(x = "Año", y = "Kilogramos") +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(face = "bold", hjust = 0.5)
)
graf
graf <- graf <- ggplot(BD, aes(x = var1, y = value, fill = var1)) +
geom_violin(color = "black", alpha = 0.8, width = 1, show.legend = FALSE) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA, show.legend = FALSE) +
geom_jitter(aes(text = tooltip_text), size = 1, color = "gray40", alpha = 0.4, width = 0.15, show.legend = FALSE) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
)
) +
labs(x = "Año", y = "Kilogramos") +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(face = "bold", hjust = 0.5)
)
# --- 7. Versión interactiva con plotly ---
graf_plotly <- plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)),
title = list(text = paste0("<b>Distribución de abastecimiento por año</b><br>",
ifelse(is.null(ALIMENTO), "Todos los alimentos", ALIMENTO)))
)
graf_plotly
plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)))
#Proyecto FAO
#Procesamiento datos SIPSA
################################################################################-
#Autores: Juliana Lalinde, Laura Quintero, Germán Angulo
#Fecha de creacion: 24/02/2024
#Fecha de ultima modificacion: 24/02/2024
################################################################################-
# Limpiar el entorno de trabajo
rm(list=ls())
# Paquetes
################################################################################-
library(readr);library(lubridate);library(dplyr);library(ggplot2);library(zoo);library(readxl)
library(glue);library(tidyverse);library(gridExtra);library(corrplot);library(arrow)
options(scipen = 999)
################################################################################-
abastecimiento_bogota_ANO_mes_alimento_completo=readRDS("abastecimiento_bogota_ANO_mes_alimento_completo_1_9.RDS")
abastecimiento_bogota_ANO_mes_total_completo=readRDS("abastecimiento_bogota_ANO_mes_total_completo_1_9.RDS")
filt1=!(abastecimiento_bogota_ANO_mes_alimento_completo$anio==2025&abastecimiento_bogota_ANO_mes_alimento_completo$mes==9)
filt2=!(abastecimiento_bogota_ANO_mes_total_completo$anio==2025&abastecimiento_bogota_ANO_mes_total_completo$mes==9)
abastecimiento_bogota_ANO_mes_alimento_completo=abastecimiento_bogota_ANO_mes_alimento_completo[filt1,]
abastecimiento_bogota_ANO_mes_total_completo=abastecimiento_bogota_ANO_mes_total_completo[filt2,]
Caja_y_Bigotes = function(ALIMENTO = NULL, formato = "numeric") {
# --- 1. Selección del dataset ---
if (!is.null(ALIMENTO)) {
BD <- subset(abastecimiento_bogota_ANO_mes_alimento_completo, producto == ALIMENTO)
} else {
BD <- abastecimiento_bogota_ANO_mes_total_completo
}
# --- 2. Limpieza y transformación ---
BD$mes <- months(as.Date(paste0("2025-", BD$mes, "-01")))
BD$suma_kg <- as.numeric(BD$suma_kg)
BD$anio <- as.factor(BD$anio)
BD <- BD[, c("anio", "suma_kg")]
names(BD) <- c("var1", "value")
BD <- BD[rowSums(is.na(BD)) == 0, ]
# --- 3. Estadísticas resumidas ---
resumen <- BD %>%
group_by(var1) %>%
summarise(
mediana = median(value, na.rm = TRUE),
q1 = quantile(value, 0.25, na.rm = TRUE),
q3 = quantile(value, 0.75, na.rm = TRUE),
promedio = mean(value, na.rm = TRUE)
)
BD <- left_join(BD, resumen, by = "var1")
# --- 4. Función para formato de texto ---
f1 <- function(x, formato) {
if (formato == "percent") {
return(scales::percent(x, accuracy = 0.1, big.mark = ".", decimal.mark = ","))
} else if (formato == "dollar") {
return(scales::dollar(x, big.mark = ".", decimal.mark = ","))
} else {
return(format(round(x), big.mark = ".", small.mark = ","))
}
}
# --- 5. Tooltip interactivo ---
BD$tooltip_text <- paste0(
"<b>Año:</b> ", BD$var1,
"<br><b>Valor:</b> ", f1(BD$value, formato),
"<br><b>Mediana:</b> ", f1(BD$mediana, formato),
"<br><b>Q1:</b> ", f1(BD$q1, formato),
"<br><b>Q3:</b> ", f1(BD$q3, formato),
"<br><b>Promedio:</b> ", f1(BD$promedio, formato)
)
# --- 6. Gráfico base ggplot ---
graf <-  ggplot(BD, aes(x = var1, y = value, fill = var1)) +
geom_violin(color = "black", alpha = 0.8, width = 1, show.legend = FALSE) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA, show.legend = FALSE) +
geom_jitter(aes(text = tooltip_text), size = 1, color = "gray40", alpha = 0.4, width = 0.15, show.legend = FALSE) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
)
) +
labs(fill = "Año", y = "Kilogramos",x="") +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(face = "bold", hjust = 0.5)
)
# --- 7. Versión interactiva con plotly ---
graf_plotly <- plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)))
# --- 8. Retorno ---
return(list(
grafico_plano = graf,
grafico_plotly = graf_plotly,
datos = BD,
resumen = resumen
))
}
Caja_y_Bigotes(ALIMENTO ="Repollo",formato="numeric")
Caja_y_Bigotes(ALIMENTO =NULL,formato="numeric")
abastecimiento_bogota_ANO_mes_alimento_completo=readRDS("abastecimiento_bogota_ANO_mes_alimento_completo_1_9.RDS")
# Proyecto FAO
# Visualizacion de DATOS   - abastecimeinto en resto
################################################################################-
#Autores: Juliana Lalinde, Laura Quintero, Germán Angulo
#Fecha de creacion: 20/03/2024
#Fecha de ultima modificacion: 23/04/2024
################################################################################-
# Limpiar el entorno de trabajo
rm(list=ls())
# Paquetes
################################################################################-
library(readr);library(lubridate);library(dplyr);library(ggplot2);library(zoo);library(readxl)
library(glue);library(tidyverse);library(gridExtra);library(corrplot);library(shiny); library(shinydashboard)
options(scipen = 999)
################################################################################-
# Corremos el codigo "002_Indices_abastecimiento_Cundinamarca.R"
source("1_9b_Indices_Distribución_de las_Cantidades_entran.R")
tags$h1("Distribución de la cantidad de productos que entran a Bogotá", class = "main-header")
BD$
ALIMENTO = NULL
formato = "numeric"
# --- 1. Selección del dataset ---
if (!is.null(ALIMENTO)) {
BD <- subset(abastecimiento_bogota_ANO_mes_alimento_completo, producto == ALIMENTO)
} else {
BD <- abastecimiento_bogota_ANO_mes_total_completo
}
# --- 2. Limpieza y transformación ---
BD$mes <- months(as.Date(paste0("2025-", BD$mes, "-01")))
BD$suma_kg <- as.numeric(BD$suma_kg)
BD$anio <- as.factor(BD$anio)
BD <- BD[, c("anio", "suma_kg")]
names(BD) <- c("var1", "value")
BD <- BD[rowSums(is.na(BD)) == 0, ]
# --- 3. Estadísticas resumidas ---
resumen <- BD %>%
group_by(var1) %>%
summarise(
mediana = median(value, na.rm = TRUE),
q1 = quantile(value, 0.25, na.rm = TRUE),
q3 = quantile(value, 0.75, na.rm = TRUE),
promedio = mean(value, na.rm = TRUE)
)
BD <- left_join(BD, resumen, by = "var1")
# --- 4. Función para formato de texto ---
f1 <- function(x, formato) {
if (formato == "percent") {
return(scales::percent(x, accuracy = 0.1, big.mark = ".", decimal.mark = ","))
} else if (formato == "dollar") {
return(scales::dollar(x, big.mark = ".", decimal.mark = ","))
} else {
return(format(round(x), big.mark = ".", small.mark = ","))
}
}
# --- 5. Tooltip interactivo ---
BD$tooltip_text <- paste0(
"<b>Año:</b> ", BD$var1,
"<br><b>Valor:</b> ", f1(BD$value, formato),
"<br><b>Mediana:</b> ", f1(BD$mediana, formato),
"<br><b>Q1:</b> ", f1(BD$q1, formato),
"<br><b>Q3:</b> ", f1(BD$q3, formato),
"<br><b>Promedio:</b> ", f1(BD$promedio, formato)
)
# --- 6. Gráfico base ggplot ---
graf <-  ggplot(BD, aes(x = var1, y = value, fill = var1)) +
geom_violin(color = "black", alpha = 0.8, width = 1, show.legend = FALSE) +
geom_boxplot(width = 0.25, color = "black", alpha = 0.7, outlier.shape = NA, show.legend = FALSE) +
geom_jitter(aes(text = tooltip_text), size = 1, color = "gray40", alpha = 0.4, width = 0.15, show.legend = FALSE) +
scale_fill_manual(
values = c(
"2013"="#1A4922","2014"="#2E7730","2015"="#0D8D38",
"2016"="#85A728","2017"="#AEBF22","2018"="#F2E203",
"2019"="#F1B709","2020"="#F39F06","2021"="#BE7E11",
"2022"="#08384D","2023"="#094B5C","2024"="#00596C",
"2025"="#006A75"
)
) +
labs(fill = "Año", y = "Kilogramos",x="") +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(face = "bold", hjust = 0.5)
)
# --- 7. Versión interactiva con plotly ---
graf_plotly <- plotly::ggplotly(graf, tooltip = "text") %>%
plotly::layout(
hoverlabel = list(bgcolor = "white", font = list(size = 12)))
Texto$
textConnection()
textConnection()
BD[BD$var1==2025,]
BD[BD$var1==2025,][1,]
S=BD[BD$var1==2025,][1,]
format(S$q1)
format(S$q1,small.mark=",",big.mark=".")
format(S$q1,decimal.mark=",",big.mark=".")
Texto=paste("Se puede observar que en el 25% de los meses se alcanza una cantidad cómo máximo de",format(S$q1,decimal.mark=",",big.mark="."),
"En el 50% de los meses se alcanza una cantidad cómo máximo de",format(S$mediana,decimal.mark=",",big.mark="."),
"En el 75% de los meses se alcanza ",format(S$q3,decimal.mark=",",big.mark="."))
list(
grafico_plano = graf,
grafico_plotly = graf_plotly,
datos = BD,
Text_=Texto,
resumen = resumen
)
runApp()
runApp()
runApp()
runApp()
