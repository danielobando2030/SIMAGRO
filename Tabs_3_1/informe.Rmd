---
title: ' '
params:
  producto: NA
  anio: NA
  datos: NA
  grafico: NA
  temporalidad: NA
  variable: NA
  promedio: NA
  fecha_max: NA
  fecha_min: NA
  prod_mas_volatil: NA
  promedio_cambio: NA
  mes_max: NA
  valor_max: NA

  # 游댠 NUEVOS PAR츼METROS PARA LOS TRES TEXTOS 游댠
  mensaje_volatil: NA
  mensaje_promedio: NA
  mensaje_mesanual: NA

output:
  pdf_document:
    latex_engine: xelatex

header-includes:
  - \usepackage{float}
  - \usepackage{arydshln}
  - \usepackage{graphicx}
  - \usepackage{xcolor}
  - \usepackage{fontspec}
  - \usepackage{booktabs}
  - \usepackage{fancyhdr}
  - \usepackage{eso-pic}
  - \usepackage{colortbl}
  - \usepackage{adjustbox}
  - \setmainfont{Prompt-Regular.ttf}
  - \definecolor{mygreen}{RGB}{255,221,0}
  - \definecolor{MYGREEN}{RGB}{255,221,0}
  - \definecolor{grayA}{RGB}{78,77,77}
  - \definecolor{green2}{RGB}{255,221,0}
  - \pagestyle{fancy}
  - \fancyfoot{}
  - \fancyhead[C]{\includegraphics[width=\textwidth]{www/logo_3.png}}
  - \renewcommand{\headrule}{\color{mygreen}\hrule width\headwidth height\headrulewidth}
  - \setlength{\headheight}{2cm}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(knitr)
library(kableExtra)
```        

\begin{flushright}
\textcolor{mygreen}{Informe en l칤nea generado el: `r format(Sys.Date(), "%d %B, %Y")`}
\end{flushright}

\section*{\textcolor{mygreen}{Par치metros con los cuales se gener칩 el informe:}}


```{r tabla_parametros, results='asis'}
library(stringr)

# Funci칩n sencilla para escapar solo el guion bajo
escape_latex <- function(x) {
  x <- as.character(x)
  str_replace_all(x, "_", "\\\\_")
}

escape_textcolor <- function(x) {
  x <- as.character(x)
  x <- stringr::str_replace_all(x, "%", "\\\\%")
  x <- stringr::str_replace_all(x, "_", "\\\\_")
  x <- stringr::str_replace_all(x, "\\$", "\\\\$")
  x <- stringr::str_replace_all(x, "#", "\\\\#")
  x <- stringr::str_replace_all(x, "\\{", "\\\\{")
  x <- stringr::str_replace_all(x, "\\}", "\\\\}")
  x
}

# --------- Construir etiquetas de par치metros ---------

# Temporalidad
temporalidad_label <- ifelse(
  is.null(params$temporalidad) || params$temporalidad == "",
  "Todos los per칤odos",
  ifelse(params$temporalidad == "mensual", "Mensual",
         ifelse(params$temporalidad == "diaria", "Diaria", params$temporalidad))
)

# A침o
anio_label <- ifelse(
  is.null(params$anio) || params$anio == "Todos los a침os",
  "Todos los a침os",
  as.character(params$anio)
)

# Producto / Alimento
producto_label <- ifelse(
  is.null(params$producto) || params$producto == "Todos los productos",
  "Todos los productos",
  params$producto
)

# Variable a graficar (nota: aqu칤 vienen nombres como precio_prom, cambio_pct_anual)
variable_label <- ifelse(
  is.null(params$variable) || params$variable == "",
  "No especificada",
  params$variable
)

# --------- Data frame de par치metros ---------
df_params <- data.frame(
  Par치metro = c("Temporalidad", "A침o", "Alimento", "Variable"),
  Valor     = c(temporalidad_label, anio_label, producto_label, variable_label),
  stringsAsFactors = FALSE
)

# --------- Impresi칩n tabla estilo FAO (sin floats) ---------
cat("\\begingroup\n")
cat("\\small\n")
cat("\\begin{adjustbox}{width=1\\textwidth}\n")
cat("\\begin{tabular}{p{4cm} @{\\hspace{5cm}} p{6cm}}\n")
cat("\\toprule\n")

for (i in 1:nrow(df_params)) {
  cat(
    escape_latex(df_params$Par치metro[i]), " & ",
    escape_latex(df_params$Valor[i]), " \\\\\n",
    sep = ""
  )
}

cat("\\bottomrule\n")
cat("\\end{tabular}\n")
cat("\\end{adjustbox}\n")
cat("\\endgroup\n")
```


\begingroup
\fontsize{14}{14}\selectfont
\textcolor{mygreen}{Comportamiento de los precios en el tiempo}
\par
\fontsize{12}{12}\selectfont
\textcolor{mygreen}{Descubre la din치mica de los precios en las centrales mayoristas de Bogot치 y Cundinamarca, as칤 como las tasas de varaci칩n de los mismos a lo largo del tiempo}
\par
\endgroup

```{r grafico_principal, echo=FALSE, out.width="100%", fig.align='center'}
knitr::include_graphics(params$grafico)
```

\vspace{0.3cm}

\begingroup
\fontsize{8}{8}\selectfont
\textcolor{mygreen}{\textbf{Fuente:} C치lculos propios a partir de datos del Sistema de Informaci칩n de Precios y Abastecimiento del Sector Agropecuario (SIPSA).}
\endgroup

\vspace{0.4cm}

\begingroup
\fontsize{10}{12}\selectfont
\textcolor{grayA}{`r escape_textcolor(params$mensaje_volatil)`}
\endgroup

\vspace{0.25cm}

\begingroup
\fontsize{10}{12}\selectfont
\textcolor{grayA}{`r escape_textcolor(params$mensaje_promedio)`}
\endgroup

\vspace{0.25cm}

\begingroup
\fontsize{10}{12}\selectfont
\textcolor{grayA}{`r escape_textcolor(params$mensaje_mesanual)`}
\endgroup

\vspace{0.4cm}

\begingroup
\fontsize{8}{8}\selectfont
\textcolor{grayA}{Este gr치fico muestra la evoluci칩n de los precios mayoristas como referencia para Bogot치 y Cundinamarca.}
\endgroup




