y = 1,
text = df$ciudad[i],
showarrow = FALSE,
yshift = yshift_value,
textangle = 90,
font = list(size = 10, family = 'Prompt', color = "#838B8B")
)
}
p <- p %>% layout(
title = 'Precio promedio mensual en relaci칩n a Bogot치',
xaxis = list(title = 'Diferencia de precio'),
yaxis = list(visible = FALSE)
)
precio_max <- round(max(df$comp))
precio_min <- round(min(df$comp))
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = p,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
# Ejemplo
resultado <- diferencias_precios_interactivo(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4 = "Banano")
resultado$grafico
diferencias_precios_interactivo <- function(opcion1, opcion2 = NULL, opcion3 = NULL, opcion4 = NULL) {
# Selecci칩n de datos seg칰n opciones
if (opcion1 == 1 & opcion2 == "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion
} else if (opcion1 == 1 & opcion2 != "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion_anual %>% filter(year == opcion2)
} else if (opcion1 == 1 & opcion2 == "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_mensual %>% filter(mes == opcion3)
} else if (opcion1 == 1 & opcion2 != "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_anual_mensual %>% filter(year == opcion2 & mes == opcion3)
} else if (opcion1 == 0 & (is.null(opcion4) | opcion4 == "Todos") & opcion2 == "" & opcion3 == "") {
df <- data_comparacion_producto %>% group_by(ciudad) %>% summarise(across(where(is.numeric), mean, na.rm = TRUE))
} else if (opcion1 == 0 & opcion2 == "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_producto %>% filter(producto == opcion4)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_anual_producto %>% filter(producto == opcion4 & year == opcion2)
} else if (opcion1 == 0 & opcion2 == "" & opcion3 != "" & !is.null(opcion4)) {
df <- data_comparacion_mensual_producto %>% filter(producto == opcion4 & mes == opcion3)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 != "" & !is.null(opcion4)) {
df_lista <- data_comparacion_anual_mensual_producto[[opcion4]]
df_lista <- as.data.frame(df_lista)
df <- filter(df_lista, year == opcion2 & mes == opcion3)
}
if(nrow(df) == 0) return("No hay datos disponibles para los criterios seleccionados.")
df <- df %>%
rename_with(~ ifelse(str_starts(.x, "sd_"), "dev", .x)) %>%
rename_with(~ ifelse(str_starts(.x, "comparacion"), "comp", .x))
# Asegurar Bogot치
if (!("Bogot치" %in% df$ciudad)) {
df <- bind_rows(df, tibble(ciudad = "Bogot치", comp = 0, dev = 0))
} else {
df$comp[df$ciudad == "Bogot치"] <- 0
df$dev[df$ciudad == "Bogot치"] <- 0
}
# Tama침o de c칤rculos
df$marker_size <- scales::rescale(df$dev, to = c(15,65))
df$marker_size[df$ciudad == "Bogot치"] <- 5
# Tooltip
df$tooltip_text <- paste0("Ciudad: ", df$ciudad,
"<br>Diferencia con Bogot치: $", round(df$comp,0),
"<br>Desviaci칩n est치ndar: ", round(df$dev,0))
# Calcular distancia de labels: c칤rculo m치s grande + 1 unidad
max_circle <- max(df$marker_size)
label_distance <- max_circle + 1  # Ajustable si quieres m치s separaci칩n
# Crear plotly
p <- plot_ly() %>%
add_trace(
data = df,
x = ~comp,
y = 1,
type = 'scatter',
mode = 'markers',
marker = list(size = ~marker_size, color = ~ciudad, colorscale = 'Viridis', showscale = FALSE),
text = ~tooltip_text,
hoverinfo = 'text'
)
# Agregar nombres pegados arriba y abajo con la misma distancia
for(i in 1:nrow(df)) {
yshift_value <- ifelse(i %% 2 == 0, label_distance, -label_distance)
p <- p %>% add_annotations(
x = df$comp[i],
y = 1,
text = df$ciudad[i],
showarrow = FALSE,
yshift = yshift_value,
textangle = 90,
font = list(size = 10, family = 'Prompt', color = "#838B8B")
)
}
p <- p %>% layout(
title = 'Precio promedio mensual en relaci칩n a Bogot치',
xaxis = list(title = 'Diferencia de precio'),
yaxis = list(visible = FALSE)
)
precio_max <- round(max(df$comp))
precio_min <- round(min(df$comp))
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = p,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
# Ejemplo
resultado <- diferencias_precios_interactivo(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4 = "Banano")
resultado$grafico
diferencias_precios_interactivo <- function(opcion1, opcion2 = NULL, opcion3 = NULL, opcion4 = NULL) {
# Paleta de colores
col_palette <- c("#007CC3", "#456ABB","#1A4922", "#2E7730", "#0D8D38", "#85A728",
"#AEBF22", "#F2E203", "#F1B709", "#F39F06", "#BE7E11",
"#08384D", "#094B5C", "#00596C", "#006A75", "#007A71",
"#00909C", "#0088BB", "#007CC3", "#456ABB")
# Selecci칩n de datos seg칰n opciones
if (opcion1 == 1 & opcion2 == "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion
} else if (opcion1 == 1 & opcion2 != "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion_anual %>% filter(year == opcion2)
} else if (opcion1 == 1 & opcion2 == "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_mensual %>% filter(mes == opcion3)
} else if (opcion1 == 1 & opcion2 != "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_anual_mensual %>% filter(year == opcion2 & mes == opcion3)
} else if (opcion1 == 0 & (is.null(opcion4) | opcion4 == "Todos") & opcion2 == "" & opcion3 == "") {
df <- data_comparacion_producto %>% group_by(ciudad) %>% summarise(across(where(is.numeric), mean, na.rm = TRUE))
} else if (opcion1 == 0 & opcion2 == "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_producto %>% filter(producto == opcion4)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_anual_producto %>% filter(producto == opcion4 & year == opcion2)
} else if (opcion1 == 0 & opcion2 == "" & opcion3 != "" & !is.null(opcion4)) {
df <- data_comparacion_mensual_producto %>% filter(producto == opcion4 & mes == opcion3)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 != "" & !is.null(opcion4)) {
df_lista <- data_comparacion_anual_mensual_producto[[opcion4]]
df_lista <- as.data.frame(df_lista)
df <- filter(df_lista, year == opcion2 & mes == opcion3)
}
if(nrow(df) == 0) return("No hay datos disponibles para los criterios seleccionados.")
df <- df %>%
rename_with(~ ifelse(str_starts(.x, "sd_"), "dev", .x)) %>%
rename_with(~ ifelse(str_starts(.x, "comparacion"), "comp", .x))
# Asegurar Bogot치
if (!("Bogot치" %in% df$ciudad)) {
df <- bind_rows(df, tibble(ciudad = "Bogot치", comp = 0, dev = 0))
} else {
df$comp[df$ciudad == "Bogot치"] <- 0
df$dev[df$ciudad == "Bogot치"] <- 0
}
# Tama침o de c칤rculos
df$marker_size <- scales::rescale(df$dev, to = c(15,65))
df$marker_size[df$ciudad == "Bogot치"] <- 5
# Tooltip
df$tooltip_text <- paste0("Ciudad: ", df$ciudad,
"<br>Diferencia con Bogot치: $", round(df$comp,0),
"<br>Desviaci칩n est치ndar: ", round(df$dev,0))
# Distancia de labels: c칤rculo m치s grande + 1 unidad
max_circle <- max(df$marker_size)
label_distance <- max_circle + 1
# Asignar colores por ciudad usando la paleta
df$color <- col_palette[seq_len(nrow(df))]
# Crear plotly
p <- plot_ly() %>%
add_trace(
data = df,
x = ~comp,
y = 1,
type = 'scatter',
mode = 'markers',
marker = list(size = ~marker_size, color = ~color, showscale = FALSE),
text = ~tooltip_text,
hoverinfo = 'text'
)
# Agregar nombres arriba y abajo
for(i in 1:nrow(df)) {
yshift_value <- ifelse(i %% 2 == 0, label_distance, -label_distance)
p <- p %>% add_annotations(
x = df$comp[i],
y = 1,
text = df$ciudad[i],
showarrow = FALSE,
yshift = yshift_value,
textangle = 90,
font = list(size = 10, family = 'Prompt', color = "#838B8B")
)
}
p <- p %>% layout(
title = 'Precio promedio mensual en relaci칩n a Bogot치',
xaxis = list(title = 'Diferencia de precio'),
yaxis = list(visible = FALSE)
)
precio_max <- round(max(df$comp))
precio_min <- round(min(df$comp))
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = p,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
# Ejemplo
resultado <- diferencias_precios_interactivo(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4 = "Banano")
resultado$grafico
data_comparacion$ciudad
diferencias_precios_interactivo <- function(opcion1, opcion2 = NULL, opcion3 = NULL, opcion4 = NULL) {
# Paleta de colores
col_palette <- c("#007CC3", "#456ABB","#1A4922", "#2E7730", "#0D8D38", "#85A728",
"#AEBF22", "#F2E203", "#F1B709", "#F39F06", "#BE7E11",
"#08384D", "#094B5C", "#00596C", "#006A75", "#007A71",
"#00909C", "#0088BB", "#007CC3", "#456ABB")
# Selecci칩n de datos seg칰n opciones
if (opcion1 == 1 & opcion2 == "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion
} else if (opcion1 == 1 & opcion2 != "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion_anual %>% filter(year == opcion2)
} else if (opcion1 == 1 & opcion2 == "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_mensual %>% filter(mes == opcion3)
} else if (opcion1 == 1 & opcion2 != "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_anual_mensual %>% filter(year == opcion2 & mes == opcion3)
} else if (opcion1 == 0 & (is.null(opcion4) | opcion4 == "Todos") & opcion2 == "" & opcion3 == "") {
df <- data_comparacion_producto %>% group_by(ciudad) %>% summarise(across(where(is.numeric), mean, na.rm = TRUE))
} else if (opcion1 == 0 & opcion2 == "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_producto %>% filter(producto == opcion4)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_anual_producto %>% filter(producto == opcion4 & year == opcion2)
} else if (opcion1 == 0 & opcion2 == "" & opcion3 != "" & !is.null(opcion4)) {
df <- data_comparacion_mensual_producto %>% filter(producto == opcion4 & mes == opcion3)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 != "" & !is.null(opcion4)) {
df_lista <- data_comparacion_anual_mensual_producto[[opcion4]]
df_lista <- as.data.frame(df_lista)
df <- filter(df_lista, year == opcion2 & mes == opcion3)
}
if(nrow(df) == 0) return("No hay datos disponibles para los criterios seleccionados.")
df <- df %>%
rename_with(~ ifelse(str_starts(.x, "sd_"), "dev", .x)) %>%
rename_with(~ ifelse(str_starts(.x, "comparacion"), "comp", .x))
# Asegurar Bogot치
if (!("Bogot치" %in% df$ciudad)) {
df <- bind_rows(df, tibble(ciudad = "Bogot치", comp = 0, dev = 0))
} else {
df$comp[df$ciudad == "Bogot치"] <- 0
df$dev[df$ciudad == "Bogot치"] <- 0
}
# Tama침o de c칤rculos
df$marker_size <- scales::rescale(df$dev, to = c(15,65))
df$marker_size[df$ciudad == "Bogot치"] <- 5
# Tooltip
df$tooltip_text <- paste0("Ciudad: ", df$ciudad,
"<br>Diferencia con Bogot치: $", round(df$comp,0),
"<br>Desviaci칩n est치ndar: ", round(df$dev,0))
# Distancia de labels: c칤rculo m치s grande + 1 unidad
max_circle <- max(df$marker_size)
label_distance <- max_circle + 1
# Asignar colores por ciudad usando la paleta
df$color <- col_palette[seq_len(nrow(df))]
# Crear plotly
p <- plot_ly() %>%
add_trace(
data = df,
x = ~comp,
y = 1,
type = 'scatter',
mode = 'markers',
marker = list(size = ~marker_size, color = ~color, showscale = FALSE),
text = ~tooltip_text,
hoverinfo = 'text'
)
# Agregar nombres arriba y abajo
for(i in 1:nrow(df)) {
yshift_value <- ifelse(i %% 2 == 0, label_distance, -label_distance)
p <- p %>% add_annotations(
x = df$comp[i],
y = 1,
text = df$ciudad[i],
showarrow = FALSE,
yshift = yshift_value,
textangle = 90,
font = list(size = 10, family = 'Prompt', color = "#838B8B")
)
}
p <- p %>% layout(
title = '',
xaxis = list(title = ''),
yaxis = list(visible = FALSE)
)
precio_max <- round(max(df$comp))
precio_min <- round(min(df$comp))
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = p,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
# Ejemplo
resultado <- diferencias_precios_interactivo(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4 = "Banano")
resultado$grafico
diferencias_precios_interactivo <- function(opcion1, opcion2 = NULL, opcion3 = NULL, opcion4 = NULL) {
# Paleta diferenciada para 19 ciudades (Bogot치 se asigna manualmente)
city_colors <- c(
"#800080", "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728",
"#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22",
"#17becf", "#aec7e8", "#ffbb78", "#98df8a", "#ff9896",
"#c5b0d5", "#c49c94", "#f7b6d2", "#c7c7c7"
)
# Selecci칩n de datos seg칰n opciones
if (opcion1 == 1 & opcion2 == "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion
} else if (opcion1 == 1 & opcion2 != "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion_anual %>% filter(year == opcion2)
} else if (opcion1 == 1 & opcion2 == "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_mensual %>% filter(mes == opcion3)
} else if (opcion1 == 1 & opcion2 != "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_anual_mensual %>% filter(year == opcion2 & mes == opcion3)
} else if (opcion1 == 0 & (is.null(opcion4) | opcion4 == "Todos") & opcion2 == "" & opcion3 == "") {
df <- data_comparacion_producto %>% group_by(ciudad) %>% summarise(across(where(is.numeric), mean, na.rm = TRUE))
} else if (opcion1 == 0 & opcion2 == "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_producto %>% filter(producto == opcion4)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_anual_producto %>% filter(producto == opcion4 & year == opcion2)
} else if (opcion1 == 0 & opcion2 == "" & opcion3 != "" & !is.null(opcion4)) {
df <- data_comparacion_mensual_producto %>% filter(producto == opcion4 & mes == opcion3)
} else if (opcion1 == 0 & opcion2 != "" & opcion3 != "" & !is.null(opcion4)) {
df_lista <- data_comparacion_anual_mensual_producto[[opcion4]]
df_lista <- as.data.frame(df_lista)
df <- filter(df_lista, year == opcion2 & mes == opcion3)
}
if(nrow(df) == 0) return("No hay datos disponibles para los criterios seleccionados.")
df <- df %>%
rename_with(~ ifelse(str_starts(.x, "sd_"), "dev", .x)) %>%
rename_with(~ ifelse(str_starts(.x, "comparacion"), "comp", .x))
# Asegurar Bogot치
if (!("Bogot치" %in% df$ciudad)) {
df <- bind_rows(df, tibble(ciudad = "Bogot치", comp = 0, dev = 0))
} else {
df$comp[df$ciudad == "Bogot치"] <- 0
df$dev[df$ciudad == "Bogot치"] <- 0
}
# Tama침o de c칤rculos
df$marker_size <- scales::rescale(df$dev, to = c(15,65))
df$marker_size[df$ciudad == "Bogot치"] <- 5
# Tooltip
df$tooltip_text <- paste0("Ciudad: ", df$ciudad,
"<br>Diferencia con Bogot치: $", round(df$comp,0),
"<br>Desviaci칩n est치ndar: ", round(df$dev,0))
# Distancia de labels: c칤rculo m치s grande + 1 unidad
max_circle <- max(df$marker_size)
label_distance <- max_circle + 1
# Asignar colores
df$color <- city_colors[seq_len(nrow(df))]
# Bogot치 siempre p칰rpura
df$color[df$ciudad == "Bogot치"] <- "#800080"
# Crear plotly
p <- plot_ly() %>%
add_trace(
data = df,
x = ~comp,
y = 1,
type = 'scatter',
mode = 'markers',
marker = list(size = ~marker_size, color = ~color, showscale = FALSE),
text = ~tooltip_text,
hoverinfo = 'text'
)
# Agregar nombres arriba y abajo, girados 90춿
for(i in 1:nrow(df)) {
yshift_value <- ifelse(i %% 2 == 0, label_distance, -label_distance)
p <- p %>% add_annotations(
x = df$comp[i],
y = 1,
text = df$ciudad[i],
showarrow = FALSE,
yshift = yshift_value,
textangle = 90,
font = list(size = 10, family = 'Prompt', color = "#838B8B")
)
}
p <- p %>% layout(
title = 'Precio promedio mensual en relaci칩n a Bogot치',
xaxis = list(title = 'Diferencia de precio'),
yaxis = list(visible = FALSE)
)
precio_max <- round(max(df$comp))
precio_min <- round(min(df$comp))
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = p,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
# Ejemplo
resultado <- diferencias_precios_interactivo(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4 = "Banano")
resultado$grafico
diferencias_precios <- function(opcion1, opcion2 = NULL, opcion3 = NULL, opcion4 = NULL) {
# Cuando no se pone ninguna opcion se muestra el promedio general de datos
if (opcion1 == 1 & opcion2 == "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion
# Se pone la opcion del a침o
} else if (opcion1 == 1 & opcion2 != "" & opcion3 == "" & is.null(opcion4)) {
df <- data_comparacion_anual %>%
filter(year == opcion2)
# Se pone la opcion del mes
} else if (opcion1 == 1 & opcion2 == "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_mensual %>%
filter(mes == opcion3)
# Se pone la opcion del mes y del a침o
} else if (opcion1 == 1 & opcion2 != "" & opcion3 != "" & is.null(opcion4)) {
df <- data_comparacion_anual_mensual %>%
filter(mes == opcion3 & year == opcion2)
# Opci칩n por producto: todos los productos promedio
} else if (opcion1 == 0 & (is.null(opcion4) | opcion4 == "Todos") & opcion2 == "" & opcion3 == "") {
df <- data_comparacion_producto %>%
group_by(ciudad) %>%
summarise(across(where(is.numeric), mean, na.rm = TRUE))
# Informaci칩n General de precios por producto
} else if (opcion1 == 0 & opcion2 == "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_producto %>%
filter(producto == opcion4)
# Informaci칩n anual (promedio) por producto
} else if (opcion1 == 0 & opcion2 != "" & opcion3 == "" & !is.null(opcion4)) {
df <- data_comparacion_anual_producto %>%
filter(producto == opcion4 & year == opcion2)
# Informaci칩n mensual (promedio) por producto
} else if (opcion1 == 0 & opcion2 == "" & opcion3 != "" & !is.null(opcion4)) {
df <- data_comparacion_mensual_producto %>%
filter(producto == opcion4 & mes == opcion3)
# Informaci칩n anual - mensual por producto
} else if (opcion1 == 0 & opcion2 != "" & opcion3 != "" & !is.null(opcion4)) {
df_lista <- data_comparacion_anual_mensual_producto[[opcion4]]
df_lista <- as.data.frame(df_lista)
df <- filter(df_lista, year == opcion2 & mes == opcion3)
}
# Renombrar variables
df <- df %>%
dplyr::rename_with(~ ifelse(str_starts(.x, "sd_"), "dev", .x)) %>%
dplyr::rename_with(~ ifelse(str_starts(.x, "comparacion"), "comp", .x))
# Evitar duplicados por ciudad
df <- df[!(duplicated(df[c("ciudad")])),]
# 游댳 Asegurar que Bogot치 siempre est칠 presente en comp=0
if (!("Bogot치" %in% df$ciudad)) {
df <- bind_rows(df, tibble(ciudad = "Bogot치", comp = 0, dev = 0))
} else {
df$comp[df$ciudad == "Bogot치"] <- 0
df$dev[df$ciudad == "Bogot치"]  <- 0
}
# Calcular 칤ndices de entrada al gr치fico
positives <- df[df$comp > 0, c("comp","ciudad")] %>%
arrange(comp) %>%
mutate(indice = row_number())
negatives <- df[df$comp < 0, c("comp","ciudad")] %>%
arrange(-comp) %>%
mutate(indice = row_number())
indices <- rbind(positives, negatives)
df <- merge(df, indices, by = c("comp","ciudad"), all = TRUE)
df$indice[is.na(df$indice)] <- 0
# Alternar 치ngulos
angulos <- 90
for (i in 2:nrow(df)) {
angulos <- c(angulos, ifelse(i %% 2 == 0, 90, -90))
}
# Gr치fico
map <- ggplot(df, aes(x = comp, y = 1, color = ciudad)) +
geom_point(aes(size = dev), alpha = 0.8) +
theme_bw() +
theme(legend.position = "none",
axis.title.y = element_blank(),
axis.text.y  = element_blank(),
axis.ticks.y = element_blank()) +
geom_text(aes(label = ciudad), size = 4.5, hjust = 2, vjust = 0,
angle = angulos, colour = "#8B8989") +
geom_vline(xintercept = 0, linetype = "longdash", size = 0.5, alpha = 0.2) +
labs(title = 'Precio promedio mensual en relaci칩n a Bogot치',
x = 'Diferencia de precio', y = '') +
scale_size(range = c(5,25)) +
scale_color_manual(values = col_palette)
precio_max <- round(max(df$comp, na.rm = TRUE))
precio_min <- round(min(df$comp, na.rm = TRUE) * -1)
ciudad_max <- df$ciudad[which.max(df$comp)]
ciudad_min <- df$ciudad[which.min(df$comp)]
return(list(
grafico = map,
datos = df,
precio_max = precio_max,
precio_min = precio_min,
ciudad_max = ciudad_max,
ciudad_min = ciudad_min
))
}
#
diferencias_precios(opcion1 = 0, opcion2 = 2014, opcion3 = "", opcion4="Banano")
