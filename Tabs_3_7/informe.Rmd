---
title: " "
params:
  producto: ""
  anio: ""
  grafico_png: ""
  mensaje1: ""
  mensaje2: ""

output:
  pdf_document:
    latex_engine: xelatex

header-includes:
  - \usepackage{float}
  - \usepackage{arydshln}
  - \usepackage{graphicx}
  - \usepackage{xcolor}
  - \usepackage{fontspec}
  - \usepackage{booktabs}
  - \usepackage{fancyhdr}
  - \usepackage{eso-pic}
  - \usepackage{adjustbox}
  - \setmainfont{Prompt-Regular.ttf}
  - \definecolor{mygreen}{RGB}{78,77,77}
  - \definecolor{grayA}{RGB}{78,77,77}
  - \pagestyle{fancy}
  - \fancyhead{}
  - \fancyfoot{}
  - \fancyhead[C]{\includegraphics[width=\textwidth]{www/logo_3.png}}
  - \renewcommand{\headrule}{\color{mygreen}\hrule width\headwidth height\headrulewidth}
  - \setlength{\headheight}{2cm}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(knitr)
library(kableExtra)
library(tools)   # ← NECESARIO PARA evitar error posterior
```

\begin{flushright}
\textcolor{mygreen}{Informe en línea generado el: `r format(Sys.Date(), "%d %B, %Y")`}
\end{flushright}

\section*{\textcolor{mygreen}{Parámetros con los cuales se generó el informe:}}


```{r tabla_parametros, results='asis'}

# Etiquetas amigables
anio_label <- params$anio
alimento_label <- params$producto   # ← el nombre del producto

# Tabla FAO oficial
df_params <- data.frame(
  Parámetro = c("Año", "Alimento"),
  Valor     = c(anio_label, alimento_label)
)

cat("\\begingroup\n")
cat("\\small\n")
cat("\\begin{adjustbox}{width=1\\textwidth}\n")
cat("\\begin{tabular}{p{4cm} @{\\hspace{5cm}} p{6cm}}\n")
cat("\\toprule\n")

for (i in 1:nrow(df_params)) {
  cat(df_params$Parámetro[i], " & ", df_params$Valor[i], " \\\\\n", sep = "")
}

cat("\\bottomrule\n")
cat("\\end{tabular}\n")
cat("\\end{adjustbox}\n")
cat("\\endgroup\n")

```

\begingroup
\fontsize{14}{14}\selectfont
\textcolor{mygreen}{Variación porcentual mensual del precio promedio}
\par
\fontsize{12}{12}\selectfont
\textcolor{mygreen}{Identifica los meses con mayor variación intermensual}
\par
\endgroup


```{r grafico_principal, echo=FALSE, message=FALSE, warning=FALSE, out.width="95%", fig.align="center"}
knitr::include_graphics(params$grafico_png)
```

\vspace{0.2cm}
\begingroup
\fontsize{8}{8}\selectfont
\textcolor{mygreen}{\textbf{Fuente:} Cálculos propios a partir de datos del Sistema de Información de Precios y Abastecimiento del Sector Agropecuario (SIPSA).}
\endgroup

\vspace{0.2cm}

```{r mensaje_panel, results='asis'}
if (!is.null(params$mensaje1) && nzchar(params$mensaje1)) {
  texto <- enc2utf8(params$mensaje1)
  
  # Escapar caracteres problemáticos para LaTeX
  texto <- gsub("\\\\", "\\\\textbackslash{}", texto)  # backslash
  texto <- gsub("([%$&#_{}])", "\\\\\\1", texto, perl = TRUE)
  
  cat("\\begingroup\n")
  cat("\\fontsize{10}{10}\\selectfont\n")
  cat("\\textcolor{grayA}{", texto, "}\n", sep = "")
  cat("\\par\n")
  cat("\\endgroup\n")
  cat("\\vspace{0.2cm}\n")
}
```

\vspace{0.25cm}
\begingroup
\fontsize{8}{8}\selectfont
\textcolor{grayA}{Esta visualizaición permite ver la variación porcentual mensual de algún alimento seleccionado, la cual se obtiene al comparar el precio promedio del mes actual con el del mes anterior, permitiendo identificar aumentos o caídas fuertes en los mercados mayoristas.}
\endgroup

\AddToShipoutPictureBG*{
  \includegraphics[width=\paperwidth,height=3cm,keepaspectratio]{www/logo_4.png}
}





