---
title: ' '
params:
  anio: NA
  datos: NA
  grafico: NA
  mensaje_altas: NA
  mensaje_bajas: NA

output:
  pdf_document:
    latex_engine: xelatex

header-includes:
  - \usepackage{float}
  - \usepackage{arydshln}
  - \usepackage{graphicx}
  - \usepackage{xcolor}
  - \usepackage{fontspec}
  - \usepackage{booktabs}
  - \usepackage{fancyhdr}
  - \usepackage{eso-pic}
  - \usepackage{colortbl}
  - \usepackage{adjustbox}
  - \setmainfont{Prompt-Regular.ttf}

  - \definecolor{mygreen}{RGB}{78,77,77}
  - \definecolor{MYGREEN}{RGB}{78,77,77}
  - \definecolor{grayA}{RGB}{78,77,77}
  - \definecolor{green2}{RGB}{78,77,77}

  - \pagestyle{fancy}
  - \fancyfoot{}
  - \fancyhead[C]{\includegraphics[width=\textwidth]{www/logo_3.png}}
  - \renewcommand{\headrule}{\color{mygreen}\hrule width\headwidth height\headrulewidth}
  - \setlength{\headheight}{2cm}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(knitr)
library(kableExtra)

```        

\begin{flushright}
\textcolor{mygreen}{Informe en línea generado el: `r format(Sys.Date(), "%d %B, %Y")`}
\end{flushright}

\section*{\textcolor{mygreen}{Parámetros con los cuales se generó el informe:}}


```{r tabla_parametros, results='asis'}
library(stringr)


# -------------------------------------------
# Función para escapar caracteres LaTeX básicos
# -------------------------------------------
escape_latex <- function(x) {
  x <- as.character(x)
  x <- str_replace_all(x, "_", "\\\\_")
  x <- str_replace_all(x, "%", "\\\\%")
  x <- str_replace_all(x, "\\$", "\\\\$")
  x <- str_replace_all(x, "#", "\\\\#")
  x <- str_replace_all(x, "\\{", "\\\\{")
  x <- str_replace_all(x, "\\}", "\\\\}")
  x
}

# -------------------------------------------
# Función para escapar texto dentro de \textcolor
# -------------------------------------------
escape_textcolor <- function(x) {
  x <- as.character(x)
  x <- str_replace_all(x, "%", "\\\\%")
  x <- str_replace_all(x, "_", "\\\\_")
  x <- str_replace_all(x, "\\$", "\\\\$")
  x <- str_replace_all(x, "#", "\\\\#")
  x <- str_replace_all(x, "\\{", "\\\\{")
  x <- str_replace_all(x, "\\}", "\\\\}")
  x
}

# Construir tabla (solo Año, porque este módulo no usa otros filtros)
df_params <- data.frame(
  Parámetro = "Año",
  Valor     = ifelse(is.null(params$anio), "No especificado", params$anio),
  stringsAsFactors = FALSE
)

# Impresión estilo FAO (sin floats)
cat("\\begingroup\n")
cat("\\small\n")
cat("\\begin{adjustbox}{width=1\\textwidth}\n")
cat("\\begin{tabular}{p{4cm} @{\\hspace{5cm}} p{6cm}}\n")
cat("\\toprule\n")

cat(
  escape_latex(df_params$Parámetro), " & ",
  escape_latex(df_params$Valor), " \\\\\n",
  sep = ""
)

cat("\\bottomrule\n")
cat("\\end{tabular}\n")
cat("\\end{adjustbox}\n")
cat("\\endgroup\n")
```
\begingroup
\fontsize{14}{14}\selectfont
\textcolor{mygreen}{Correlaciones entre precios}
\par
\fontsize{12}{12}\selectfont
\textcolor{mygreen}{Descubre }
\par
\endgroup

```{r grafico_principal, echo=FALSE, out.width="100%", fig.align='center'}
knitr::include_graphics(params$grafico)
```

\vspace{0.3cm}

\begingroup
\fontsize{8}{8}\selectfont
\textcolor{mygreen}{\textbf{Fuente:} Cálculos propios a partir de datos del Sistema de Información de Precios y Abastecimiento del Sector Agropecuario (SIPSA).}
\endgroup

\vspace{0.4cm}

\begingroup
\fontsize{12}{14}\selectfont
\textcolor{mygreen}{\textbf{Correlaciones más altas:}}
\endgroup

\vspace{0.15cm}

\begingroup
\fontsize{10}{12}\selectfont
\textcolor{grayA}{`r escape_textcolor(params$mensaje_altas)`}
\endgroup

\vspace{0.5cm}

\begingroup
\fontsize{12}{14}\selectfont
\textcolor{mygreen}{\textbf{Correlaciones más bajas:}}
\endgroup

\vspace{0.15cm}

\begingroup
\fontsize{10}{12}\selectfont
\textcolor{grayA}{`r escape_textcolor(params$mensaje_bajas)`}
\endgroup

\vspace{0.25cm}


\begingroup
\fontsize{8}{8}\selectfont
\textcolor{grayA}{Este gráfico muestra la correlación de los precios mayoristas como referencia para Bogotá y Cundinamarca. Donde un valor cercano a 1 indica que los dos productos se mueven en la misma dirección, y valores cercanos a -1 indican que los precios alimentos tienden a moverse de manera contraria.}
\endgroup

\newpage

\vspace*{6cm}

\AddToShipoutPictureBG*{
  \includegraphics[width=\paperwidth,height=3cm,keepaspectratio]{www/logo_4.png}
}